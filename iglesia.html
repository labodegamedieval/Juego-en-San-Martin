<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‚õ™ Iglesia de San Mart√≠n</title>
  <link rel="stylesheet" href="styles/style.css"/>
  <link rel="icon" type="image/jpeg" href="images/escudo-borrado.jpg"/>
  <style>
    .organ-container {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin: 20px auto;
    }

    .key {
      width: 50px;
      height: 150px;
      background: #eee;
      border: 2px solid #555;
      border-radius: 4px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      cursor: pointer;
      transition: background 0.3s;
    }

    .key.active {
      background: gold;
    }

    .pista {
      margin-top: 15px;
      font-style: italic;
      color: #444;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>‚õ™ Iglesia de San Mart√≠n</h1>
      <div class="music-control">
        <button class="music-btn"><span class="music-icon">üéµ</span> M√∫sica</button>
      </div>
    </header>

    <section id="content">
      <div class="stop-icon">‚õ™</div>

      <div id="location-check">
        <h2>Verifica tu ubicaci√≥n</h2>
        <p>Col√≥cate frente a la puerta g√≥tico-mud√©jar de la iglesia.</p>
        <button class="action-btn" onclick="checkLocation()">Verificar GPS</button>
        <p>O escribe el nombre:</p>
        <input type="text" id="location-input" placeholder="Ej: Iglesia" />
        <button class="action-btn" onclick="checkLocationManual()">Verificar Manual</button>
        <p id="location-status"></p>
        <img id="direction-arrow" src="images/flecha.png" class="arrow-icon" style="display: none;" />
      </div>

      <div id="game-content" style="display: none;">
        <div class="carousel">
          <div class="slide active">
            <img src="images/retablo.jpg" alt="Interior de la Iglesia" />
            <p><strong>Interior:</strong> Retablos barrocos, capilla del Evangelio y arcos g√≥tico-mud√©jar √∫nicos. Si la iglesia est√° cerrada, te va a interesar este link. <a href="https://www.salamancamudejar.com/ruta-sur/" target="_blank">M√°s info</a></p>
          </div>
          <div class="slide">
            <img src="images/iglesia.jpg" alt="Exterior de la Iglesia" />
            <p><strong>Fachada:</strong> Entrada en piedra y ladrillo con campanario de cinco campanas.</p>
          </div>
          <button class="carousel-btn prev-slide">‚Üê</button>
          <button class="carousel-btn next-slide">‚Üí</button>
        </div>

        <h2>üéº Reto del √ìrgano</h2>
        <p>üéπ Toca las teclas del antiguo √≥rgano siguiendo la secuencia secreta.<br><span class="pista">Pista: Las campanas de San Mart√≠n ta√±en con el alba: DO, FA, RE, SOL</span></p>

        <div class="organ-container">
          <div class="key" data-note="do"></div>
          <div class="key" data-note="re"></div>
          <div class="key" data-note="mi"></div>
          <div class="key" data-note="fa"></div>
          <div class="key" data-note="sol"></div>
          <div class="key" data-note="la"></div>
        </div>

        <p id="vitraux-feedback" class="pista"></p>

        <div class="fragmento-final" id="fragmento-final" style="display: none;">
          <p><strong>Fragmento del Mensaje:</strong> <span id="message-piece">la fe del pueblo gu√≠a las almas...</span></p>
          <p><strong>QR en el pueblo:</strong> IGLESIA-1300</p>
          <p><strong>Dato Curioso:</strong> Se conserva una estela funeraria romana a la izquierda del portal. Sugerencia: si la fortuna os acompa√±a y la panader√≠a est√° abierta podr√©is adquirir sus famosas perronillas... a lo mejor os dan alguna pista.</p>
        </div>

        <div id="continue-button" style="display: none;">
          <button class="action-btn" onclick="location.href='felicitaciones.html?stop=iglesia'">Continuar aventura</button>
        </div>
      </div>
    </section>

    <audio id="organ-do" src="sounds/organ-do.mp3" preload="auto"></audio>
    <audio id="organ-re" src="sounds/organ-re.mp3" preload="auto"></audio>
    <audio id="organ-mi" src="sounds/organ-mi.mp3" preload="auto"></audio>
    <audio id="organ-fa" src="sounds/organ-fa.mp3" preload="auto"></audio>
    <audio id="organ-sol" src="sounds/organ-sol.mp3" preload="auto"></audio>
    <audio id="organ-la" src="sounds/organ-la.mp3" preload="auto"></audio>
    <audio id="organ-full" src="sounds/organ-full.mp3" preload="auto"></audio>
    <audio id="error-sound" src="sounds/error.mp3" preload="auto"></audio>
    <audio id="background-music" src="sounds/musica-medieval.mp3" preload="auto" loop></audio>

    <footer>
      <p>¬© 2025 La Bodega Medieval |
        <a href="https://www.labodegamedieval.es" target="_blank">Reserva tu visita </a>
      </p>
    </footer>

    <script>
      const secuenciaCorrecta = ["do", "fa", "re", "sol"];
      let entradaUsuario = [];

      document.querySelectorAll('.key').forEach(key => {
        key.addEventListener('click', () => {
          const nota = key.dataset.note;
          entradaUsuario.push(nota);

          document.getElementById(`organ-${nota}`).currentTime = 0;
          document.getElementById(`organ-${nota}`).play();

          key.classList.add('active');
          setTimeout(() => key.classList.remove('active'), 300);

          if (entradaUsuario.length === secuenciaCorrecta.length) {
            if (JSON.stringify(entradaUsuario) === JSON.stringify(secuenciaCorrecta)) {
              document.getElementById("vitraux-feedback").textContent = "üé∂ ¬°Has reproducido la melod√≠a sagrada!";
              document.getElementById("fragmento-final").style.display = "block";
              document.getElementById("continue-button").style.display = "block";
              localStorage.setItem("iglesia-completed", "true");
              document.getElementById("organ-full").play();
            } else {
              document.getElementById("vitraux-feedback").textContent = "‚ùå Esa no era la secuencia. Vuelve a intentarlo.";
              document.getElementById("error-sound").play();
            }
            entradaUsuario = [];
          }
        });
      });
    </script>
</body>
</html>
