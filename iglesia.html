<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‚õ™ Iglesia de San Mart√≠n</title>
  <link rel="stylesheet" href="styles/style.css"/>
  <link rel="icon" type="image/jpeg" href="images/escudo-borrado.jpg"/>
  <style>
    .vitraux-container {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 20px auto;
    }

    .vitraux {
      width: 80px;
      height: 120px;
      border-radius: 12px;
      background: rgba(0, 0, 0, 0.2);
      border: 3px solid #999;
      box-shadow: inset 0 0 10px rgba(0,0,0,0.4);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .lit {
      box-shadow: 0 0 20px 8px yellow;
      transform: scale(1.1);
      border-color: gold;
    }

    .pista {
      margin-top: 15px;
      font-style: italic;
      color: #444;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>‚õ™ Iglesia de San Mart√≠n</h1>
      <div class="music-control">
        <button class="music-btn"><span class="music-icon">üéµ</span> M√∫sica</button>
      </div>
    </header>

    <section id="content">
      <div class="stop-icon">‚õ™</div>

      <div id="location-check">
        <h2>Verifica tu ubicaci√≥n</h2>
        <p>Col√≥cate frente a la puerta g√≥tico-mud√©jar de la iglesia.</p>
        <button class="action-btn" onclick="checkLocation()">Verificar GPS</button>
        <p>O escribe el nombre:</p>
        <input type="text" id="location-input" placeholder="Ej: Iglesia" />
        <button class="action-btn" onclick="checkLocationManual()">Verificar Manual</button>
        <p id="location-status"></p>
        <img id="direction-arrow" src="images/flecha.png" class="arrow-icon" style="display: none;" />
      </div>

      <div id="game-content" style="display: none;">
        <div class="carousel">
          <div class="slide active">
            <img src="images/retablo.jpg" alt="Interior de la Iglesia" />
            <p><strong>Interior:</strong> Retablos barrocos, capilla del Evangelio y arcos g√≥tico-mud√©jar √∫nicos. Si la iglesia est√° cerrada, te va a interesar este link. <a href="https://www.salamancamudejar.com/ruta-sur/" target="_blank">M√°s info</a></p>
          </div>
          <div class="slide">
            <img src="images/iglesia.jpg" alt="Exterior de la Iglesia" />
            <p><strong>Fachada:</strong> Entrada en piedra y ladrillo con campanario de cinco campanas.</p>
          </div>
          <button class="carousel-btn prev-slide">‚Üê</button>
          <button class="carousel-btn next-slide">‚Üí</button>
        </div>

        <h2>üïØÔ∏è Reto: Enciende los vitrales</h2>
        <p>Ilumina la iglesia tocando los vitrales en el orden que marca la tradici√≥n. <br><span class="pista">üîç Pista: el orden lo marca el escudo de San Mart√≠n: sangre, oro y cielo.</span></p>

        <div class="vitraux-container">
          <div class="vitraux" id="vitraux-1" onclick="activarVitraux(0)" style="background: rgba(255, 0, 0, 0.4);"></div>
          <div class="vitraux" id="vitraux-2" onclick="activarVitraux(1)" style="background: rgba(255, 215, 0, 0.4);"></div>
          <div class="vitraux" id="vitraux-3" onclick="activarVitraux(2)" style="background: rgba(0, 0, 255, 0.4);"></div>
          <div class="vitraux" id="vitraux-4" onclick="activarVitraux(3)" style="background: rgba(255, 255, 255, 0.4);"></div>
        </div>

        <p id="vitraux-feedback" class="pista"></p>

        <div class="fragmento-final" id="fragmento-final" style="display: none;">
          <p><strong>Fragmento del Mensaje:</strong> <span id="message-piece">la fe del pueblo gu√≠a las almas...</span></p>
          <p><strong>QR en el pueblo:</strong> IGLESIA-1300</p>
          <p><strong>Dato Curioso:</strong> Se conserva una estela funeraria romana a la izquierda del portal. Sugerencia: si la fortuna os acompa√±a y la panader√≠a est√° abierta podr√©is adquirir sus famosas perronillas... a lo mejor os dan alguna pista.</p>
        </div>

        <div id="continue-button" style="display: none;">
          <button class="action-btn" onclick="location.href='felicitaciones.html?stop=iglesia'">Continuar aventura</button>
        </div>
      </div>
    </section>

    <audio id="success-sound" src="sounds/success.mp3" preload="auto"></audio>
    <audio id="error-sound" src="sounds/error.mp3" preload="auto"></audio>
    <audio id="cheers-sound" src="sounds/cheers.mp3" preload="auto"></audio>
    <audio id="organ-sound" src="sounds/organ.mp3" preload="auto"></audio>
    <audio id="background-music" src="sounds/musica-medieval.mp3" preload="auto" loop></audio>

    <footer>
      <p>¬© 2025 La Bodega Medieval |
        <a href="https://www.labodegamedieval.es" target="_blank">Reserva tu visita </a>
      </p>
    </footer>

    <script>
      const ordenCorrecto = [0, 1, 2, 3]; // Rojo, Dorado, Azul, Blanco
      let secuencia = [];
      let vitrales = document.querySelectorAll(".vitraux");

      function activarVitraux(indice) {
        secuencia.push(indice);
        vitrales[indice].classList.add("lit");

        if (secuencia.length === ordenCorrecto.length) {
          setTimeout(() => {
            if (JSON.stringify(secuencia) === JSON.stringify(ordenCorrecto)) {
              document.getElementById("vitraux-feedback").textContent = "‚ú® ¬°La iglesia se ha iluminado con gloria!";
              document.getElementById("fragmento-final").style.display = "block";
              document.getElementById("continue-button").style.display = "block";
              localStorage.setItem("iglesia-completed", "true");
              playSound("organ-sound");
            } else {
              document.getElementById("vitraux-feedback").textContent = "‚ùå Orden incorrecto. Intenta de nuevo.";
              playSound("error-sound");
              resetVitraux();
            }
          }, 300);
        }
      }

      function resetVitraux() {
        secuencia = [];
        vitrales.forEach(v => v.classList.remove("lit"));
      }

      function playSound(id) {
        const snd = document.getElementById(id);
        snd.currentTime = 0;
        snd.play();
      }
    </script>
</body>
</html>
