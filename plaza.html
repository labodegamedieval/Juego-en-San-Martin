<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>🏟️ Plaza de Toros</title>
  <style>
    body {
      background: url('images/pergamino.jpg') no-repeat center center fixed;
      background-size: cover;
      font-family: Georgia, serif;
      color: #3b241b;
      padding: 0;
      margin: 0;
    }

    .container {
      max-width: 950px;
      margin: auto;
      background: rgba(255, 248, 228, 0.96);
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
      text-align: center;
    }

    h1 {
      font-size: 2em;
      margin-bottom: 20px;
    }

    .carousel {
      position: relative;
      margin-bottom: 30px;
    }

    .carousel img {
      width: 100%;
      border-radius: 10px;
      border: 2px solid #6b3e2e;
    }

    .carousel p {
      text-align: center;
      font-style: italic;
      margin-top: 10px;
    }

    canvas {
      border: 3px solid #5e3b1b;
      border-radius: 12px;
      display: block;
      margin: 0 auto 20px;
      background: #fcefdc;
    }

    #fragmento {
      display: none;
      padding: 20px;
      margin-top: 20px;
      border: 2px solid #6b3e2e;
      border-radius: 12px;
      background: url('images/pergamino.png');
      background-size: cover;
      font-weight: bold;
    }

    .action-btn {
      display: none;
      margin-top: 20px;
      padding: 12px 20px;
      font-size: 18px;
      background-color: #d6b88a;
      border: 2px solid #5e3b1b;
      border-radius: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>🏟️ Plaza de Toros</h1>
    <p>Gonzalo dejó un cartel enigmático con pistas ocultas... Pero hoy lo descubrirás con tu puntería medieval.</p>

    <div class="carousel">
      <img src="images/plaza-tradicion.jpg" alt="Capeas en la plaza" />
      <p>Las capeas del 11 de agosto, símbolo de identidad local. Esta plaza de toros es una de las más antiguas de España, construida en el siglo XVII aprovechando el patio de armas del castillo. Conserva gradas originales de piedra y se sigue utilizando durante las fiestas patronales.</p>
      <p><strong>Curiosidad:</strong> Algunos vecinos afirman que Gonzalo fue visto por última vez entre los burladeros antes de su desaparición misteriosa en una noche de capeas.</p>
      <p><a href="https://sanmartindelcastanar.es/plaza-de-toros/" target="_blank">🔗 Más información sobre la Plaza de Toros</a></p>
    </div>

    <canvas id="gameCanvas" width="600" height="300"></canvas>
    <p>🎯 Acierta a la <strong>copa</strong>, el <strong>escudo</strong> y el <strong>racimo de uvas</strong> para ganar.</p>
    <div id="fragmento">📜 Fragmento revelado: "...y el brindis selló su destino bajo el estruendo de la plaza."</div>
    <button id="continue-button" class="action-btn" onclick="location.href='felicitaciones.html?stop=plaza'">Continuar la aventura</button>
  </div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    const objetivos = ['🍷', '🛡️', '🍇', '🐂', '⚔️', '🎭'];
    const blancos = [];
    const aciertos = new Set();
    const targetsObjetivo = ['🍷', '🛡️', '🍇'];

    const filas = [60, 140, 220];
    const velocidad = 1.2;

    for (let y of filas) {
      for (let i = 0; i < 6; i++) {
        blancos.push({
          x: -Math.random() * 600,
          y,
          icono: objetivos[Math.floor(Math.random() * objetivos.length)]
        });
      }
    }

    function dibujar() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      blancos.forEach(b => {
        ctx.font = '32px serif';
        ctx.fillText(b.icono, b.x, b.y);
        b.x += velocidad;
        if (b.x > canvas.width + 40) {
          b.x = -Math.random() * 600;
          b.icono = objetivos[Math.floor(Math.random() * objetivos.length)];
        }
      });
      requestAnimationFrame(dibujar);
    }

    canvas.addEventListener('click', e => {
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;

      blancos.forEach(b => {
        if (x > b.x - 20 && x < b.x + 20 && y > b.y - 30 && y < b.y) {
          if (targetsObjetivo.includes(b.icono)) {
            aciertos.add(b.icono);
          }
        }
      });

      if (aciertos.size === 3) {
        document.getElementById('fragmento').style.display = 'block';
        document.getElementById('continue-button').style.display = 'block';
        localStorage.setItem("plaza-completed", "true");
      }
    });

    dibujar();
  </script>
</body>
</html>
