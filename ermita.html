<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‚õ≤ Fuente y Portal√≥n</title>
  <link rel="stylesheet" href="styles/style.css">
  <link rel="icon" type="image/jpeg" href="images/escudo-borrado.jpg">
  <!-- Se puede incluir alguna fuente medieval si se desea, por ejemplo: -->
  <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap" rel="stylesheet">
  <style>
    /* ===============================
         ESTILOS GENERALES
       =============================== */
    body {
      font-family: 'MedievalSharp', Georgia, serif;
      background: url('images/fondo-fuente.jpg') no-repeat center center fixed;
      background-size: cover;
      margin: 0;
      padding: 0;
      color: #3c2a1e;
      text-shadow: 1px 1px 2px #fff;
    }
    .container {
      max-width: 960px;
      margin: auto;
      background: rgba(255,248,228,0.95);
      border: 3px double #5e3b1b;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 0 15px rgba(0,0,0,0.4);
      position: relative;
    }
    header h1 { text-align: center; }
    .action-btn {
      display: block;
      margin: 15px auto;
      padding: 10px 20px;
      font-size: 16px;
      background: #dec79b;
      border: 2px solid #5e3b1b;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    .music-control { text-align: center; margin-bottom: 10px; }
    #content { margin-top: 10px; }
    
    /* ===============================
         UBICACI√ìN
       =============================== */
    #location-check {
      text-align: center;
      margin-bottom: 30px;
    }
    #location-check input {
      padding: 8px;
      font-size: 16px;
      width: 200px;
      margin: 10px;
      border: 1px solid #5e3b1b;
      border-radius: 4px;
    }
    #location-status { margin-top: 10px; font-size: 1.1em; color: red; }
    #direction-arrow { width: 50px; margin-top: 10px; }
    
    /* ===============================
         CARRUSEL (id√©ntico a Ermita)
       =============================== */
    .carousel-container {
      position: relative;
      overflow: hidden;
      width: 100%;
      margin-bottom: 20px;
      border-radius: 10px;
      border: 2px solid #5e3b1b;
    }
    .carousel-slides {
      display: flex;
      transition: transform 0.5s ease;
      width: 300%; /* 3 diapositivas */
    }
    .carousel-slide {
      flex: 0 0 100%;
      box-sizing: border-box;
      text-align: center;
      padding: 10px;
    }
    .carousel-slide img {
      width: 100%;
      height: 300px;             /* Altura fija */
      object-fit: contain;       /* Muestra la imagen completa sin recorte */
      background-color: #fff;    /* Fondo blanco para evitar zonas vac√≠as */
      border-radius: 10px;
      border: 2px solid #6b3e2e;
      display: block;
    }
    /* Bloque para el pie de foto */
    .carousel-info {
      margin-top: 10px;
      line-height: 1.4;
      background: rgba(255,255,255,0.8);
      padding: 8px;
      border-radius: 8px;
    }
    .carousel-info a {
      color: #5e3b1b;
      text-decoration: underline;
    }
    .carousel-info a:hover { color: #a65c3a; }
    .carousel-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255,255,255,0.7);
      border: none;
      font-size: 24px;
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
    }
    .prev-slide { left: 10px; }
    .next-slide { right: 10px; }
    
    /* ===============================
         FOOTER Y ADORNOS
       =============================== */
    footer p {
      text-align: center;
      font-size: 0.9em;
      margin-top: 20px;
    }
    .container:before {
      content: "‚öîÔ∏è";
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 32px;
      color: #5e3b1b;
    }
    .container:after {
      content: "üõ°Ô∏è";
      position: absolute;
      bottom: 10px;
      right: 10px;
      font-size: 32px;
      color: #5e3b1b;
    }
    @media screen and (max-width: 768px) {
      .container { max-width: 90%; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>‚õ≤ Fuente y Portal√≥n</h1>
      <div class="music-control">
        <button class="action-btn music-btn">
          <span class="music-icon">üéµ</span> Pausar M√∫sica
        </button>
      </div>
    </header>
    
    <!-- Secci√≥n de Verificaci√≥n de Ubicaci√≥n -->
    <section id="location-check">
      <h2>Verifica tu ubicaci√≥n</h2>
      <p>Ac√©rcate a la fuente y al portal√≥n para continuar.</p>
      <button class="action-btn" onclick="checkLocation()">Verificar GPS</button>
      <p>O escribe el nombre:</p>
      <input type="text" id="location-input" placeholder="Ej: Fuente y Portal√≥n">
      <button class="action-btn" onclick="checkLocationManual()">Verificar Manual</button>
      <p id="location-status"></p>
      <img id="direction-arrow" src="images/flecha.png" alt="Flecha de direcci√≥n" style="display:none;">
    </section>
    
    <!-- Contenido principal -->
    <section id="game-content" style="display:none;">
      <!-- Carousel -->
      <div class="carousel-container">
        <div class="carousel-slides">
          <div class="carousel-slide active">
            <img src="images/portalon.jpg" alt="Portal√≥n">
            <div class="carousel-info">
              <strong>Portal√≥n:</strong> Lugar renacentista de reuni√≥n y comercio. A√∫n conserva inscripciones originales.
              <a href="https://sanmartindelcasta√±ar.es/plaza-mayor-y-portalon/" target="_blank">M√°s info</a>
            </div>
          </div>
          <div class="carousel-slide">
            <img src="images/fuente-detalle.jpg" alt="Fuente">
            <div class="carousel-info">
              <strong>Fuente:</strong> De dos ca√±os con decoraci√≥n geom√©trica, construida en el siglo XVI.
              <a href="https://turismosierradefrancia.es/nuestros-pueblos/san-martin-del-castanar/" target="_blank">M√°s info</a>
            </div>
          </div>
          <div class="carousel-slide">
            <img src="images/portalon-interior.jpg" alt="Portal√≥n interior">
            <div class="carousel-info">
              <strong>Interior:</strong> Perspectiva del portal√≥n y sus detalles, evocando tiempos pasados.
              <a href="https://es.wikipedia.org/wiki/San_Mart%C3%ADn_del_Casta%C3%B1ar" target="_blank">M√°s info</a>
            </div>
          </div>
        </div>
        <button class="carousel-btn prev-slide" onclick="prevSlide()">&#10094;</button>
        <button class="carousel-btn next-slide" onclick="nextSlide()">&#10095;</button>
      </div>
      
      <!-- Aqu√≠ se pueden a√±adir otros contenidos espec√≠ficos de la parada -->
    </section>
    
    <footer>
      <p>¬© 2025 La Bodega Medieval | <a href="https://www.labodegamedieval.es" target="_blank">Reserva tu visita</a></p>
    </footer>
    
    <audio id="background-music" src="sounds/musica-medieval.mp3" preload="auto" loop></audio>
    <script>
      // Funciones de verificaci√≥n de ubicaci√≥n
      const targetLat = 40.123456, targetLon = -3.123456, thresholdDistance = 50;
      function checkLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(geoSuccess, locationError);
        } else {
          document.getElementById("location-status").textContent = "Tu navegador no soporta geolocalizaci√≥n.";
        }
      }
      function geoSuccess(position) {
        const lat = position.coords.latitude, lon = position.coords.longitude;
        const distance = calculateDistance(lat, lon, targetLat, targetLon);
        if (distance <= thresholdDistance) unlockStop();
        else document.getElementById("location-status").textContent = "No est√°s lo suficientemente cerca de la Fuente y Portal√≥n.";
      }
      function locationError(err) {
        document.getElementById("location-status").textContent = "Error al obtener tu ubicaci√≥n: " + err.message;
      }
      function calculateDistance(lat1, lon1, lat2, lon2) {
        const R = 6371e3;
        const toRad = x => x * Math.PI / 180;
        const œÜ1 = toRad(lat1), œÜ2 = toRad(lat2);
        const ŒîœÜ = toRad(lat2 - lat1), ŒîŒª = toRad(lon2 - lon1);
        const a = Math.sin(ŒîœÜ/2)**2 + Math.cos(œÜ1)*Math.cos(œÜ2)*Math.sin(ŒîŒª/2)**2;
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        return R * c;
      }
      function checkLocationManual() {
        const input = document.getElementById("location-input").value.trim().toLowerCase();
        if (input === "fuente" || input === "fuente y portal√≥n" || input === "fuente y portalon") unlockStop();
        else document.getElementById("location-status").textContent = "Nombre incorrecto. Int√©ntalo nuevamente.";
      }
      function unlockStop() {
        document.getElementById("location-check").style.display = "none";
        document.getElementById("game-content").style.display = "block";
        initCarousel();
        playSound("background-music");
      }
      
      // Carousel
      let currentSlide = 0, slides;
      function initCarousel() {
        slides = document.querySelectorAll('.carousel-slide');
      }
      function updateCarousel() {
        const carouselSlides = document.querySelector('.carousel-slides');
        carouselSlides.style.transform = `translateX(${-currentSlide * 100}%)`;
      }
      function nextSlide() {
        currentSlide = (currentSlide < slides.length - 1) ? currentSlide + 1 : 0;
        updateCarousel();
      }
      function prevSlide() {
        currentSlide = (currentSlide > 0) ? currentSlide - 1 : slides.length - 1;
        updateCarousel();
      }
      
      // Bot√≥n de m√∫sica
      document.addEventListener('DOMContentLoaded', () => {
        const musicBtn = document.querySelector('.music-btn');
        const backgroundMusic = document.getElementById('background-music');
        musicBtn.addEventListener('click', () => {
          if (backgroundMusic.paused) {
            backgroundMusic.play();
            musicBtn.innerHTML = '<span class="music-icon">üéµ</span> Pausar M√∫sica';
          } else {
            backgroundMusic.pause();
            musicBtn.innerHTML = '<span class="music-icon">üîá</span> Reproducir M√∫sica';
          }
        });
      });
      
      function playSound(id) {
        const sound = document.getElementById(id);
        if (sound) sound.play();
      }
    </script>
  </div>
</body>
</html>
