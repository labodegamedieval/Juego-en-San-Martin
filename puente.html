<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üåâ Puente Medieval</title>
  <link rel="stylesheet" href="styles/style.css"/>
  <link rel="icon" type="image/jpeg" href="images/escudo-borrado.jpg"/>
  <style>
    .image-zone {
      position: relative;
      max-width: 600px;
      margin: 20px auto;
    }
    .image-zone img {
      width: 100%;
      border-radius: 8px;
    }
    .hidden-hotspot {
      position: absolute;
      width: 6%;
      height: 10%;
      top: 47%;
      left: 72.5%;
      cursor: pointer;
      z-index: 10;
    }
    .bitcoin-symbol {
  position: absolute;
  font-size: 12px;
  color: orange;
  top: 47%;
  left: 72.5%;
  z-index: 9;
  pointer-events: none;
}

  </style>
  <!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GE0YB9PL8Q"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){ dataLayer.push(arguments); }
  gtag('js', new Date());
  gtag('config', 'G-GE0YB9PL8Q');
</script>

</head>
<body>
  <div class="container">
    <header>
      <h1>üåâ Puente Medieval</h1>
      <div class="music-control">
        <button class="music-btn"><span class="music-icon">üéµ</span> M√∫sica</button>
      </div>
    </header>

    <section id="content">
      <div class="stop-icon">üåâ</div>

      <div id="location-check">
        <h2>Verifica tu ubicaci√≥n</h2>
        <p>Ac√©rcate al puente de piedra para continuar.</p>
        <button class="action-btn" onclick="checkLocation()">Verificar GPS</button>
        <p>O escribe el nombre:</p>
        <input type="text" id="location-input" placeholder="Ej: Puente" />
        <button class="action-btn" onclick="checkLocationManual()">Verificar Manual</button>
        <p id="location-status"></p>
        <img id="direction-arrow" src="images/flecha.png" class="arrow-icon" style="display: none;" />
      </div>

      <div id="game-content" style="display: none;">
        <div class="carousel">
          <div class="slide active">
            <img src="images/puente-medieval.jpg" alt="Puente Medieval" />
            <p><strong>Vista lateral:</strong> <p>Desde este lugar part√≠a tambi√©n una <strong>antigua calzada romana secundaria</strong>, hoy parcialmente conservada, que cruzaba el <strong>r√≠o Canderuelo</strong> y se dirig√≠a hacia <strong>La Legoriza</strong>, un importante yacimiento metal√∫rgico visigodo del siglo <strong>VII</strong>. All√≠ se fund√≠a hierro para fabricar herramientas, monedas y otros objetos esenciales.</p>.</p>
          </div>
          <div class="slide">
            <img src="images/puente-rio.jpg" alt="R√≠o y entorno" />
            <p><strong>Entorno natural:</strong> Cruza el r√≠o Canderuelo rodeado de vegetaci√≥n. <a href="https://sanmartindelcasta√±ar.es/puente-y-calzada-romana/" target="_blank">M√°s info</a></p>
          </div>
          <div class="slide">
            <img src="images/puente-sendero.jpeg" alt="Entrada y salida " />
            <p><strong>Entorno natural:</strong> Siglos de historia que las piedras desgastadas susurran al cruzar. <a href="https://sanmartindelcasta√±ar.es/puente-y-calzada-romana/" target="_blank">M√°s info</a></p>
          </div>
          <button class="carousel-btn prev-slide">‚Üê</button>
          <button class="carousel-btn next-slide">‚Üí</button>
        </div>

        <div class="quiz">
          <h2>üîç Encuentra el s√≠mbolo oculto</h2>
          <p>Observa la imagen y toca el arco central del puente.</p>
          <div class="image-zone">
            <img src="images/A_medieval_stone_bridge_with_a_single_semicircular.png" alt="Puente secreto" />
            <div class="bitcoin-symbol">‚Çø</div>
            <div class="hidden-hotspot" onclick="revealMessage()" title="¬°Has dado en el blanco!"></div>
          </div>
          <button class="action-btn" onclick="showHint()">üïØÔ∏è Pista</button>
          <p id="puzzle-feedback" style="margin-top:10px;"></p>
        </div>

        <div class="fragmento-final">
          <p><strong>Fragmento del Mensaje:</strong> <span id="message-piece" style="display:none;">escudo</span></p>
          <p><strong>QR en el entorno del puente:</strong> No hay caballo ni corcel, pero s√≠ sill√≠n y pedal fiel. No avanza, aunque ruede sin parar‚Ä¶ bajo su trono, un qr vas a encontrar</p>
          <p><strong>Dato Curioso:</strong> Este puente resisti√≥ una gran crecida del r√≠o Canderuelo en 1650.</p>
        </div>

        <div id="continue-button" style="display: none;">
          <button class="action-btn" onclick="location.href='felicitaciones.html?stop=puente'">Continuar b√∫squeda</button>
        </div>
      </div>
    </section>

    <audio id="success-sound" src="sounds/success.mp3" preload="auto"></audio>
    <audio id="error-sound" src="sounds/error.mp3" preload="auto"></audio>
    <audio id="cheers-sound" src="sounds/cheers.mp3" preload="auto"></audio>
    <audio id="background-music" src="sounds/musica-medieval.mp3" preload="auto" loop></audio>

    <footer>
      <p>¬© 2025 La Bodega Medieval |
        <a href="https://www.labodegamedieval.es" target="_blank">Reserva tu visita</a>
      </p>
    </footer>

    <script>
  function playSound(id) {
    const sound = document.getElementById(id);
    if (sound) {
      sound.currentTime = 0;
      sound.play();
    }
  }

  function revealMessage() {
    const msg = document.getElementById("message-piece");
    const feedback = document.getElementById("puzzle-feedback");
    const btn = document.getElementById("continue-button");

    if (msg.style.display !== "inline") {
      msg.style.display = "inline";
      feedback.textContent = "‚úÖ ¬°S√≠mbolo encontrado! Estaba en el arco.";
      btn.style.display = "block";
      playSound("cheers-sound");
      localStorage.setItem("puente-completed", "true");
    }
  }

  function showHint() {
    const feedback = document.getElementById("puzzle-feedback");
    feedback.textContent = "üí° Pista: Est√° justo en el arco central del puente, cerca de la base.";
    playSound("success-sound");
  }

  const puenteCoords = {
    lat: 40.522552,
    lng: -6.065858,
    maxDistance: 20
  };

  function checkLocation() {
    if (!navigator.geolocation) {
      showStatus("‚ùå Geolocalizaci√≥n no disponible en este navegador.");
      playSound("error-sound");
      return;
    }

    navigator.geolocation.getCurrentPosition(
      (position) => {
        const distance = getDistanceFromLatLonInMeters(
          position.coords.latitude,
          position.coords.longitude,
          puenteCoords.lat,
          puenteCoords.lng
        );

        if (distance <= puenteCoords.maxDistance) {
          unlockContent("‚úÖ Ubicaci√≥n verificada. Puedes continuar.");
        } else {
          showStatus(`üìç Est√°s a ${Math.round(distance)} metros del puente. Ac√©rcate m√°s para continuar.`);
          playSound("error-sound");
        }
      },
      () => {
        showStatus("‚ùå No se pudo obtener tu ubicaci√≥n.");
        playSound("error-sound");
      }
    );
  }

  function checkLocationManual() {
    const input = document.getElementById("location-input").value.trim().toLowerCase();
    if (input === "puente" || input === "puente medieval") {
      unlockContent("‚úÖ Verificaci√≥n manual correcta. Puedes continuar.");
    } else {
      showStatus("‚ùå Nombre incorrecto. Intenta de nuevo.");
      playSound("error-sound");
    }
  }

  function unlockContent(message) {
    document.getElementById("location-status").textContent = message;
    document.getElementById("game-content").style.display = "block";
    document.getElementById("location-check").style.display = "none";
    playSound("success-sound");
    localStorage.setItem("puente-completed", "true");
  }

  function showStatus(message) {
    document.getElementById("location-status").textContent = message;
  }

  function getDistanceFromLatLonInMeters(lat1, lon1, lat2, lon2) {
    const R = 6371e3;
    const toRad = (value) => value * Math.PI / 180;
    const dLat = toRad(lat2 - lat1);
    const dLon = toRad(lon2 - lon1);
    const a =
      Math.sin(dLat / 2) ** 2 +
      Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
      Math.sin(dLon / 2) ** 2;
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    return R * c;
  }
</script>

    <script>
  let currentSlide = 0;
  const slides = document.querySelectorAll(".carousel .slide");
  const prevBtn = document.querySelector(".carousel-btn.prev-slide");
  const nextBtn = document.querySelector(".carousel-btn.next-slide");

  function showSlide(index) {
    slides.forEach((slide, i) => {
      slide.classList.toggle("active", i === index);
    });
  }

  prevBtn.addEventListener("click", () => {
    currentSlide = (currentSlide - 1 + slides.length) % slides.length;
    showSlide(currentSlide);
  });

  nextBtn.addEventListener("click", () => {
    currentSlide = (currentSlide + 1) % slides.length;
    showSlide(currentSlide);
  });

  showSlide(currentSlide); // Mostrar primera slide al cargar
</script>

</body>
</html>
