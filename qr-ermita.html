<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QR Ermita | Juego Tur√≠stico San Mart√≠n</title>
  <meta name="description" content="Descubre los vestigios romanos y visigodos en la parada de la ermita de San Mart√≠n del Casta√±ar." />
  
  <!-- Precargas optimizadas -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preload" href="pergamino-fondo.jpg" as="image" type="image/jpeg" />
  <link rel="preload" href="images/ermita-humilladero.png" as="image" type="image/png" />
  <link rel="preload" href="sounds/audio-ermita-es.mp3" as="audio" type="audio/mpeg" />
  
  <!-- Fuentes -->
  <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap" rel="stylesheet" />
  
  <style>
    /* Variables CSS mejoradas */
    :root {
      --color-papel: rgba(255, 255, 240, 0.92);
      --color-rojo-oscuro: #8B0000;
      --color-rojo-medio: #A52A2A;
      --color-rojo-claro: #CD5C5C;
      --color-texto: #3e2f1c;
      --color-texto-claro: #5a4a37;
      --sombra-principal: 0 8px 32px rgba(0, 0, 0, 0.3);
      --sombra-secundaria: 0 4px 16px rgba(139, 0, 0, 0.2);
      --borde-principal: 8px solid var(--color-rojo-oscuro);
      --transicion-suave: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --radio-borde: 16px;
    }

    /* Reset y base */
    * {
      box-sizing: border-box;
    }

    body {
      background: linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.1)), 
                  url('pergamino-fondo.jpg') no-repeat center center fixed;
      background-size: cover;
      font-family: 'MedievalSharp', serif;
      color: var(--color-texto);
      margin: 0;
      padding: 1rem;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      line-height: 1.6;
    }

    /* Contenedor principal mejorado */
    main.contenedor {
      background: var(--color-papel);
      border: var(--borde-principal);
      border-radius: var(--radio-borde);
      box-shadow: var(--sombra-principal);
      max-width: 900px;
      width: 100%;
      padding: 2.5rem;
      position: relative;
      backdrop-filter: blur(8px);
    }

    /* Selector de idioma mejorado */
    .language-selector {
      position: absolute;
      top: 1.5rem;
      right: 1.5rem;
      display: flex;
      gap: 0.75rem;
      background: rgba(255, 255, 240, 0.8);
      padding: 0.75rem;
      border-radius: 25px;
      backdrop-filter: blur(4px);
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
      z-index: 10;
    }

    .language-btn {
      font-size: 1.8rem;
      background: none;
      border: none;
      cursor: pointer;
      transition: var(--transicion-suave);
      padding: 0.5rem;
      border-radius: 50%;
      position: relative;
    }

    .language-btn:hover {
      transform: scale(1.2);
      background: rgba(139, 0, 0, 0.1);
    }

    .language-btn.active {
      transform: scale(1.1);
      background: var(--color-rojo-oscuro);
      color: white;
    }

    .language-btn:focus {
      outline: 2px solid var(--color-rojo-medio);
      outline-offset: 2px;
    }

    /* Tipograf√≠a mejorada */
    h1 {
      color: var(--color-rojo-oscuro);
      font-size: clamp(1.8rem, 4vw, 2.5rem);
      text-align: center;
      margin: 0 0 2rem 0;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
      letter-spacing: 1px;
    }

    p {
      font-size: clamp(1.1rem, 2.5vw, 1.3rem);
      text-align: justify;
      margin: 1.5rem 0;
      color: var(--color-texto);
      text-indent: 1.5rem;
    }

    p:first-of-type {
      margin-top: 0;
    }

    strong {
      color: var(--color-rojo-oscuro);
      font-weight: bold;
    }

    em {
      color: var(--color-rojo-medio);
      font-style: italic;
    }

    /* Figura e imagen mejoradas */
    figure.imagen {
      margin: 2rem 0;
      border: 4px solid var(--color-rojo-medio);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: var(--sombra-secundaria);
      transition: var(--transicion-suave);
    }

    figure.imagen:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(139, 0, 0, 0.3);
    }

    figure.imagen img {
      width: 100%;
      height: auto;
      display: block;
      transition: var(--transicion-suave);
    }

    figure.imagen:hover img {
      transform: scale(1.02);
    }

    figcaption {
      text-align: center;
      font-style: italic;
      margin: 1rem 0 0 0;
      color: var(--color-texto-claro);
      font-size: 1.1rem;
      padding: 0 1rem;
    }

    /* Audio mejorado */
    audio {
      width: 100%;
      margin: 2rem 0;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    /* Bot√≥n volver mejorado */
    .volver {
      display: inline-block;
      margin-top: 2.5rem;
      padding: 1rem 2rem;
      background: linear-gradient(45deg, var(--color-rojo-medio), var(--color-rojo-claro));
      color: white;
      text-decoration: none;
      border-radius: 12px;
      transition: var(--transicion-suave);
      font-weight: bold;
      font-size: 1.1rem;
      box-shadow: 0 4px 12px rgba(165, 42, 42, 0.3);
      border: 2px solid transparent;
    }

    .volver:hover {
      background: linear-gradient(45deg, var(--color-rojo-oscuro), var(--color-rojo-medio));
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(139, 0, 0, 0.4);
    }

    .volver:focus {
      outline: none;
      border-color: white;
    }

    /* Animaciones de entrada */
    .language-content {
      animation: fadeIn 0.5s ease-in-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Estados de visibilidad */
    .language-content[hidden] {
      display: none;
    }

    /* Responsive mejorado */
    @media (max-width: 768px) {
      body {
        padding: 0.5rem;
      }

      main.contenedor {
        padding: 1.5rem;
        margin-top: 4rem;
      }

      .language-selector {
        top: 1rem;
        right: 1rem;
        padding: 0.5rem;
        gap: 0.5rem;
      }

      .language-btn {
        font-size: 1.5rem;
        padding: 0.25rem;
      }

      p {
        text-indent: 1rem;
      }

      .volver {
        width: 100%;
        text-align: center;
        margin-top: 2rem;
      }
    }

    @media (max-width: 480px) {
      main.contenedor {
        padding: 1rem;
      }

      h1 {
        margin-bottom: 1.5rem;
      }

      figure.imagen {
        margin: 1.5rem 0;
      }
    }

    /* Modo impresi√≥n */
    @media print {
      body {
        background: white;
        color: black;
      }

      main.contenedor {
        box-shadow: none;
        border: 2px solid black;
        background: white;
      }

      .volver, 
      .language-selector,
      audio {
        display: none;
      }

      p {
        color: black;
      }

      h1 {
        color: black;
      }
    }

    /* Accesibilidad mejorada */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }

    /* Focus visible para navegaci√≥n por teclado */
    :focus-visible {
      outline: 3px solid var(--color-rojo-medio);
      outline-offset: 2px;
    }
  </style>

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-GE0YB9PL8Q"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-GE0YB9PL8Q');
  </script>
</head>
<body>
  <main class="contenedor">
    <div class="language-selector">
      <button class="language-btn active" data-lang="es" aria-label="Espa√±ol">üá™üá∏</button>
      <button class="language-btn" data-lang="en" aria-label="English">üá¨üáß</button>
      <button class="language-btn" data-lang="fr" aria-label="Fran√ßais">üá´üá∑</button>
      <button class="language-btn" data-lang="de" aria-label="Deutsch">üá©üá™</button>
    </div>

    <div id="es-content" class="language-content" role="main">
      <h1>üèõÔ∏è ¬øSab√≠as que...?</h1>
      <p>Muy cerca de esta ermita se conserva una <strong>aut√©ntica estela funeraria romana</strong>, dedicada al peque√±o <em>Tancino</em>, fallecido con apenas <strong>cuatro a√±os</strong>, y recordado por su padre <em>Ambato</em>. No es la √∫nica: se han encontrado <strong>dos estelas</strong> romanas junto a este templo, lo que indica que por la zona <strong>existi√≥ una peque√±a necr√≥polis rural</strong>.</p>
      <p>Desde este lugar part√≠a tambi√©n una <strong>antigua calzada romana secundaria</strong>, hoy parcialmente conservada, que cruzaba el <strong>r√≠o Canderuelo</strong> y se dirig√≠a hacia <strong>La Legoriza</strong>, un importante yacimiento metal√∫rgico visigodo del siglo <strong>VII</strong>. All√≠ se fund√≠a hierro para fabricar herramientas, monedas y otros objetos esenciales.</p>
      <p>San Mart√≠n del Casta√±ar conserva, en muy poco espacio, <strong>milenios de historia superpuestos</strong>: del Imperio Romano a los pueblos visigodos, pasando por ermitas medievales y secretos tallados en piedra.</p>
      <figure class="imagen">
        <img src="images/ermita-humilladero.png" alt="Estela funeraria romana dedicada a Tancino" loading="lazy" />
        <figcaption>‚õ™ Memoria de tiempos antiguos</figcaption>
      </figure>
      <audio controls preload="metadata" aria-label="Audio explicativo en espa√±ol">
        <source src="sounds/audio-ermita-es.mp3" type="audio/mpeg" />
        Tu navegador no soporta el elemento de audio.
      </audio>
    </div>

    <div id="en-content" class="language-content" role="main" hidden>
      <h1>üèõÔ∏è Did you know...?</h1>
      <p>Very close to this hermitage lies a <strong>genuine Roman funerary stele</strong>, dedicated to little <em>Tancinus</em>, who died at just <strong>four years old</strong>, remembered by his father <em>Ambatus</em>. It is not the only one: <strong>two Roman steles</strong> have been found next to this temple, suggesting the existence of a <strong>rural necropolis</strong> in the area.</p>
      <p>From here also began an <strong>ancient Roman secondary road</strong>, partially preserved today, which crossed the <strong>Canderuelo River</strong> and led to <strong>La Legoriza</strong>, an important Visigothic metallurgical site from the <strong>7th century</strong>. There, iron was smelted to make tools, coins, and other essential objects.</p>
      <p>San Mart√≠n del Casta√±ar holds, in a small space, <strong>millennia of layered history</strong>: from the Roman Empire to the Visigoths, passing through medieval hermitages and secrets carved in stone.</p>
      <figure class="imagen">
        <img src="images/ermita-humilladero.png" alt="Roman funerary stele dedicated to Tancinus" loading="lazy" />
        <figcaption>‚õ™ Memory of ancient times</figcaption>
      </figure>
      <audio controls preload="metadata" aria-label="Explanatory audio in English">
        <source src="sounds/audio-ermita-en.mp3" type="audio/mpeg" />
        Your browser does not support the audio element.
      </audio>
    </div>

    <div id="fr-content" class="language-content" role="main" hidden>
      <h1>üèõÔ∏è Le saviez-vous...?</h1>
      <p>Tout pr√®s de cette chapelle se trouve une <strong>v√©ritable st√®le fun√©raire romaine</strong>, d√©di√©e au petit <em>Tancinus</em>, d√©c√©d√© √† seulement <strong>quatre ans</strong>, et comm√©mor√© par son p√®re <em>Ambatus</em>. Ce n'est pas la seule : <strong>deux st√®les</strong> romaines ont √©t√© retrouv√©es √† c√¥t√© de ce temple, indiquant l'existence probable d'une <strong>n√©cropole rurale</strong>.</p>
      <p>De cet endroit partait aussi une <strong>ancienne voie secondaire romaine</strong>, aujourd'hui partiellement conserv√©e, qui traversait la <strong>rivi√®re Canderuelo</strong> et menait √† <strong>La Legoriza</strong>, un important site m√©tallurgique wisigothique du <strong>VIIe si√®cle</strong>. On y fondait le fer pour fabriquer outils, monnaies et autres objets essentiels.</p>
      <p>San Mart√≠n del Casta√±ar conserve, sur un espace r√©duit, <strong>des mill√©naires d'histoire superpos√©e</strong> : de l'Empire romain aux Wisigoths, en passant par des ermitages m√©di√©vaux et des secrets grav√©s dans la pierre.</p>
      <figure class="imagen">
        <img src="images/ermita-humilladero.png" alt="St√®le fun√©raire romaine d√©di√©e √† Tancinus" loading="lazy" />
        <figcaption>‚õ™ M√©moire des temps anciens</figcaption>
      </figure>
      <audio controls preload="metadata" aria-label="Audio explicatif en fran√ßais">
        <source src="sounds/audio-ermita-fr.mp3" type="audio/mpeg" />
        Votre navigateur ne supporte pas l'√©l√©ment audio.
      </audio>
    </div>

    <div id="de-content" class="language-content" role="main" hidden>
      <h1>üèõÔ∏è Wusstest du schon...?</h1>
      <p>Ganz in der N√§he dieser Kapelle befindet sich eine <strong>echte r√∂mische Grabstele</strong>, gewidmet dem kleinen <em>Tancinus</em>, der mit nur <strong>vier Jahren</strong> verstarb, in Erinnerung an seinen Vater <em>Ambatus</em>. Es ist nicht die einzige: <strong>zwei Stelen</strong> wurden neben diesem Tempel gefunden, was auf eine <strong>l√§ndliche Nekropole</strong> in der Umgebung hinweist.</p>
      <p>Von hier aus f√ºhrte auch eine <strong>alte r√∂mische Nebenstra√üe</strong>, die heute teilweise erhalten ist, √ºber den <strong>Fluss Canderuelo</strong> nach <strong>La Legoriza</strong>, einem bedeutenden westgotischen Metallurgiezentrum aus dem <strong>7. Jahrhundert</strong>. Dort wurde Eisen geschmolzen, um Werkzeuge, M√ºnzen und andere wichtige Gegenst√§nde herzustellen.</p>
      <p>San Mart√≠n del Casta√±ar bewahrt auf kleinstem Raum <strong>Jahrtausende √ºberlagerter Geschichte</strong>: vom R√∂mischen Reich √ºber die Westgoten bis hin zu mittelalterlichen Kapellen und in Stein gemei√üelten Geheimnissen.</p>
      <figure class="imagen">
        <img src="images/ermita-humilladero.png" alt="R√∂mische Grabstele gewidmet Tancinus" loading="lazy" />
        <figcaption>‚õ™ Erinnerung an vergangene Zeiten</figcaption>
      </figure>
      <audio controls preload="metadata" aria-label="Erl√§uterndes Audio auf Deutsch">
        <source src="sounds/audio-ermita-de.mp3" type="audio/mpeg" />
        Ihr Browser unterst√ºtzt das Audio-Element nicht.
      </audio>
    </div>

    <div>
      <a class="volver" href="../explorar.html" role="button">üîô Volver al juego</a>
    </div>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const languageButtons = document.querySelectorAll('.language-btn');
      const languageContents = document.querySelectorAll('.language-content');
      
      // Funci√≥n para cambiar idioma
      function changeLanguage(targetLang) {
        // Actualizar botones
        languageButtons.forEach(btn => {
          btn.classList.toggle('active', btn.dataset.lang === targetLang);
        });
        
        // Actualizar contenido
        languageContents.forEach(content => {
          const isTarget = content.id === `${targetLang}-content`;
          content.hidden = !isTarget;
          
          if (isTarget) {
            content.setAttribute('role', 'main');
          } else {
            content.removeAttribute('role');
          }
        });
        
        // Actualizar idioma del documento
        document.documentElement.lang = targetLang;
        
        // Pausar todos los audios
        document.querySelectorAll('audio').forEach(audio => {
          audio.pause();
        });
      }
      
      // Event listeners para botones de idioma
      languageButtons.forEach(button => {
        button.addEventListener('click', function() {
          const lang = this.dataset.lang;
          changeLanguage(lang);
          // Focus management for accessibility
          this.focus();
        });
        
        // Soporte para teclado
        button.addEventListener('keydown', function(e) {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            this.click();
          }
        });
      });
      
      // Detectar idioma preferido del navegador
      const browserLang = navigator.language.split('-')[0];
      const supportedLangs = ['es', 'en', 'fr', 'de'];
      const defaultLang = supportedLangs.includes(browserLang) ? browserLang : 'es';
      
      // Solo cambiar si no es espa√±ol (ya est√° activo por defecto)
      if (defaultLang !== 'es') {
        changeLanguage(defaultLang);
      }
      
      // Manejo de errores para audio
      document.querySelectorAll('audio').forEach(audio => {
        audio.addEventListener('error', function() {
          console.warn('Error loading audio:', this.src);
        });
      });
      
      // Lazy loading para im√°genes (fallback si el navegador no lo soporta)
      if ('IntersectionObserver' in window) {
        const imageObserver = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              const img = entry.target;
              if (img.dataset.src) {
                img.src = img.dataset.src;
                img.removeAttribute('data-src');
                imageObserver.unobserve(img);
              }
            }
          });
        });
        
        document.querySelectorAll('img[data-src]').forEach(img => {
          imageObserver.observe(img);
        });
      }
    });
  </script>
</body>
</html>
